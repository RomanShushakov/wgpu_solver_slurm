services:
  mariadb:
    image: mariadb:12.1.2
    container_name: slurm-mariadb
    restart: unless-stopped

    # Bind only to localhost so it's not exposed to the internet
    ports:
      - "127.0.0.1:3306:3306"

    environment:
      MARIADB_ROOT_PASSWORD: "rootpass_change_me"
      MARIADB_DATABASE: "slurm_acct_db"
      MARIADB_USER: "slurm"
      MARIADB_PASSWORD: "slurmpass_change_me"

    volumes:
      - slurm_mariadb_data:/var/lib/mysql

    healthcheck:
      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
      interval: 5s
      timeout: 3s
      retries: 30

volumes:
  slurm_mariadb_data:
